<!DOCTYPE html>
<html lang="ru" class="page">

@include('partials/head.html')

<body class="page__body">
  <div class="site-container" id="site-container">
    @include('partials/header.html')

    <main class="quality">
      <div class="quality__title">
        @include('partials/buffer_top.html')
        @include('partials/arrowback.html')
        <h1 id="heading-q" class="heading">контроль качества</h1>
      </div>

      <section class="quality" id="quality01">

          <div class="content">
            <div class="accordionQ accordionQ-1">
              <div class="accordionQ__control" aria-expanded="false">
                <span class="accordionQ__icon">01</span>
                <img src="img/quality-01-2x.png" alt="Сертификация FSSC 22000"/>
                <span class="accordionQ__title">
                  <h2>Сертификация FSSC 22000</h2>
                </span>
              </div>
              <div class="accordionQ__content" aria-hidden="true">
                <div class="container flex">
                  <img src="img/quality-01-2x.png" alt="Сертификация FSSC 22000"/>
                  <p>Система менеджмента безопастности пищевой продукции производственной площадки, внедрена с 2015 года</p>
                </div>
              </div>
            </div>

            <div class="accordionQ accordionQ-2">
              <div class="accordionQ__control" aria-expanded="false">
                <span class="accordionQ__icon">02</span>
                <img src="img/quality-02-2x.png" alt="Анализ поступившего сырья" />
                <span class="accordionQ__title">
                  <h2>Анализ поступившего сырья</h2>
                </span>
              </div>
              <div class="accordionQ__content" aria-hidden="true">
                <div class="container flex">
                  <img src="img/quality-02-2x.png" alt="Анализ поступившего сырья" />
                  <p>На входе все сырье проходит контроль качества в собственных лабораториях и при нахождении отклонений от заявленных показателей отправляется обратно</p>
              </div>
              </div>
            </div>

            <div class="accordionQ accordionQ-3">
              <div class="accordionQ__control" aria-expanded="false">
                <span class="accordionQ__icon">03</span>
                <img src="img/quality-03.png" alt="Изготовление продуктов в строгом соответствии с рецептурами" />
                <span class="accordionQ__title">
                  <h2>Изготовление продуктов в строгом соответствии с рецептурами</h2>
                </span>
              </div>
              <div class="accordionQ__content" aria-hidden="true">
                <div class="container flex">
                  <img src="img/quality-03.png" alt="Изготовление продуктов в строгом соответствии с рецептурами" />
                  <p>Контроль на каждом этапе производства помогает делать эталонные продукты с одним и тем же вкусом на протяжении многих лет</p>
                </div>
              </div>
            </div>

            <div class="accordionQ accordionQ-4">
              <div class="accordionQ__control" aria-expanded="false">
                <span class="accordionQ__icon">04</span>
                <img src="img/quality-04.png" alt="Шоковая заморозка" />
                <span class="accordionQ__title">
                  <h2>Шоковая заморозка</h2>
                </span>
              </div>
              <div class="accordionQ__content" aria-hidden="true">
                <div class="container flex">
                  <img src="img/quality-04.png" alt="Шоковая заморозка" />
                  <p>Продукты в среднем замораживаются за 20 минут, что помогает лучше сохранять структуру тканей и поэтому пищевая ценность и вкусовые качества остаются неизменными</p>
                </div>
              </div>
            </div>

            <div class="accordionQ accordionQ-5">
              <div class="accordionQ__control" aria-expanded="false">
                <span class="accordionQ__icon">05</span>
                <img src="img/quality-05.png" alt="Металлодетектор на выходе с линии" />
                <span class="accordionQ__title">
                  <h2>Металлодетектор на выходе с линии</h2>
                </span>
              </div>
              <div class="accordionQ__content" aria-hidden="true">
                <div class="container flex">
                  <img src="img/quality-05.png" alt="Металлодетектор на выходе с линии" />
                  <p>Каждая упаковка проверяется на наличие металических инородных предметов</p>
                </div>
              </div>
            </div>

            <div class="accordionQ accordionQ-6">
              <div class="accordionQ__control" aria-expanded="false">
                <span class="accordionQ__icon">06</span>
                <img src="img/quality-06.png" alt="Лабораторные исследования" />
                <span class="accordionQ__title">
                  <h2>Лабораторные исследования</h2>
                </span>
              </div>
              <div class="accordionQ__content" aria-hidden="true">
                <div class="container flex">
                  <img src="img/quality-06.png" alt="Лабораторные исследования" />
                  <p>Собственные физико-химическая и микробиологическая лаборатории аккредитованные с 2013 года проводят ряд исследований</p>
                </div>
              </div>
            </div>

            <div class="accordionQ accordionQ-7">
              <div class="accordionQ__control" aria-expanded="false">
                <span class="accordionQ__icon">07</span>
                <img src="img/quality-07.png" alt="Дегустация каждой произведённой партии" />
                <span class="accordionQ__title">
                  <h2>Дегустация каждой произведённой партии</h2>
                </span>
              </div>
              <div class="accordionQ__content" aria-hidden="true">
                <div class="container flex">
                  <img src="img/quality-07.png" alt="Дегустация каждой произведённой партии" />
                  <p>Специальная дегустационная панель, прошедшая обучение сенсорному анализу, изучает вкусовые качества каждой партии. В случае несоответствия эталону партия не отправляется к покупателям</p>
                </div>
              </div>
            </div>

            <div class="accordionQ accordionQ-8">
              <div class="accordionQ__control" aria-expanded="false">
                <span class="accordionQ__icon">08</span>
                <img src="img/quality-08.png" alt="Анализ поступившего сырья" />
                <span class="accordionQ__title">
                  <h2>Контроль условий хранения и логистики</h2>
                </span>
              </div>
              <div class="accordionQ__content" aria-hidden="true">
                <div class="container flex">
                  <img src="img/quality-08.png" alt="Анализ поступившего сырья" />
                  <p>Продукция хранится в морозильных камерах при температуре -18 градусов Цельсия и доставляется до торговых точек в специально оборудованных автомобилях также при -18</p>
                </div>
              </div>
            </div>

            <div class="pagination-track">
              <div class="pagination">
                <div class="pagination__bullet current"></div>
                <div class="pagination__bullet"></div>
                <div class="pagination__bullet"></div>
                <div class="pagination__bullet"></div>
                <div class="pagination__bullet"></div>
                <div class="pagination__bullet"></div>
                <div class="pagination__bullet"></div>
                <div class="pagination__bullet"></div>
              </div>
            </div>
          </div>

      </section>
      <div class="fake"></div>
    </main>
    @include('partials/footer.html')
  </div>

  <script type="text/javascript">
    // ================== ACCORDION PLUGINS LABS =================
      class GraphAccordionQ {
        constructor(selector, options) {
          let defaultOptions = {
            isOpen: () => {
              console.log(this)
              if (this.accordion.classList.contains('is-open')) {
                return true;
              } else {
                return false;
              }
            },
            isClose: () => { },
            speed: 300
          };

          this.options = Object.assign(defaultOptions, options);
          this.accordion = document.querySelector(selector);
          this.control = this.accordion.querySelector('.accordionQ__control');
          this.content = this.accordion.querySelector('.accordionQ__content');
          this.event();
        }

        event() {
          if (this.accordion) {
            this.accordion.addEventListener('click', (e) => {
              this.accordion.classList.toggle('open');
              if (this.accordion.classList.contains('open')) {
                this.open();
              } else {
                this.close();
              }
            });
          }
        }

        open() {
          this.accordion.style.setProperty('--accordion-time', `${this.options.speed / 1000}s`);
          this.accordion.classList.add('is-open');
          this.control.setAttribute('aria-expanded', true);
          this.content.setAttribute('aria-hidden', false);
          this.content.style.maxHeight = this.content.scrollHeight + 'px';
          this.options.isOpen(this);
        }

        close() {
          this.accordion.classList.remove('is-open');
          this.control.setAttribute('aria-expanded', false);
          this.content.setAttribute('aria-hidden', true);
          this.content.style.maxHeight = null;
          this.options.isClose(this);
        }
      }

      // const accordion1 = new GraphAccordionQ('.accordionQ-1', {
      //     speed: 500
      //   });
      // accordion1.open();
      //
      // const accordion2 = new GraphAccordionQ('.accordionQ-2', {
      //     speed: 500
      //   });
      // accordion2.open();
      //
      // const accordion3 = new GraphAccordionQ('.accordionQ-3', {
      //   speed: 500
      // });
      // accordion3.open();
      //
      // const accordion4 = new GraphAccordionQ('.accordionQ-4', {
      //   speed: 500
      // });
      // accordion4.open();
      //
      // const accordion5 = new GraphAccordionQ('.accordionQ-5', {
      //   speed: 500
      // });
      // accordion5.open();
      //
      // const accordion6 = new GraphAccordionQ('.accordionQ-6', {
      //   speed: 500
      // });
      // accordion6.open();
      //
      // const accordion7 = new GraphAccordionQ('.accordionQ-7', {
      //   speed: 500
      // });
      // accordion7.open();
      //
      // const accordion8 = new GraphAccordionQ('.accordionQ-8', {
      //   speed: 500
      // });
      // accordion8.open();



  // function changeWheelSpeed(container, speedY) {
  //   var removed = false;
  //   var scrollY = 0;
  //   var handleScrollReset = function () {
  //     scrollY = container.scrollTop;
  //   };
  //   var handleMouseWheel = function (e) {
  //     e.preventDefault();
  //     scrollY += speedY * e.deltaY
  //     if (scrollY < 0) {
  //       scrollY = 0;
  //     } else {
  //       var limitY = container.scrollHeight - container.clientHeight;
  //       if (scrollY > limitY) {
  //         scrollY = limitY;
  //       }
  //     }
  //     container.scrollTop = scrollY;
  //   };
  //   console.log(scrollY)
  //   container.addEventListener('mouseup', handleScrollReset, false);
  //   container.addEventListener('mousedown', handleScrollReset, false);
  //   container.addEventListener('mousewheel', handleMouseWheel, false);
  //   return function () {
  //     if (removed) {
  //       return;
  //     }
  //     container.removeEventListener('mouseup', handleScrollReset, false);
  //     container.removeEventListener('mousedown', handleScrollReset, false);
  //     container.removeEventListener('mousewheel', handleMouseWheel, false);
  //     removed = true;
  //   };
  // }

  // Usage example:
  //var element = document.querySelector('#quality01');
  // changeWheelSpeed(element, 0.5);  // 0.5 * default_scroll_speed  // 2 times slower

 // document.querySelector('#quality01').addEventListener("scroll", scrollPointsQual);

  function scrollPointsQual() {
    var scrollpercent = (document.body.scrollTop + document.documentElement.scrollTop) / (document.documentElement.scrollHeight - document.documentElement.clientHeight)*100;
    //var scrollY = document.documentElement.scrollTop;
    var scrollY = document.querySelector('#quality01').scrollTop;

    if (document.documentElement.scrollTop > 320) {
      document.querySelector('#quality01').style.marginTop = document.documentElement.scrollTop + 'px';
      console.log(accordion1.accordion.classList.contains('is-open'))
    }
    console.log(scrollY, getBlockPositionY('.accordionQ-1'))
    //var draw = length * scrollpercent;
    if ((scrollY > getBlockPositionY('.accordionQ-1') + 40) && accordion1.accordion.classList.contains('is-open')) {
      accordion1.close(); }

    if ((scrollY > getBlockPositionY('.accordionQ-2') + 140)  && accordion2.accordion.classList.contains('is-open')) {
      accordion2.close();
    }
    if ((scrollY > getBlockPositionY('.accordionQ-3') + 140)   && accordion3.accordion.classList.contains('is-open')) {
      accordion3.close();
    }
    if ((scrollY > getBlockPositionY('.accordionQ-4') + 140)   && accordion4.accordion.classList.contains('is-open')) {
      accordion4.close();
    }
    if((scrollY > getBlockPositionY('.accordionQ-5') + 140) && accordion5.accordion.classList.contains('is-open')) {
      accordion5.close();
    }
    if ((scrollY > getBlockPositionY('.accordionQ-6') + 140) && accordion6.accordion.classList.contains('is-open')) {
      accordion6.close();
    }
    if ((scrollY > getBlockPositionY('.accordionQ-7') + 140)  && accordion7.accordion.classList.contains('is-open')) {
      accordion7.close();
    }

    if ((scrollY > getBlockPositionY('.accordionQ-8') + 140) && accordion8.accordion.classList.contains('is-open')) {
      accordion8.close();
    }

    // Переверните чертеж (при прокрутке вверх)
    // triangle.style.strokeDashoffset = length - draw;
  }

  function getBlockPositionY(element) {
    return document.querySelector(element).getBoundingClientRect().y
  }

  document.documentElement.scrollTop = 0;

  const wrapper = document.querySelector("main.quality");
  const compStyle = getComputedStyle(wrapper);
  const sectionName = ".accordionQ";
  const sections = document.querySelectorAll(sectionName);
  const bullets = document.querySelectorAll(".pagination__bullet");
  const foldedHeight = parseInt(compStyle.getPropertyValue("--folded-height"));
  const stickyOffset = parseInt(compStyle.getPropertyValue("--sticky-offset"));
  const parentOffset = sections[0].offsetParent.offsetTop;
  const breakpoints = Array.prototype.map.call(
    sections,
    (el) => parentOffset + el.offsetTop - stickyOffset
  );
  let currentSection = 0;

  sections.forEach((el, index) => {
    const scrollToSection = () => window.scrollTo({ top: breakpoints[index] });
    el.querySelector(`${sectionName}__control`).addEventListener("click", scrollToSection);
    bullets[index].addEventListener("click", scrollToSection);
  });

  window.addEventListener("scroll", function () {
    breakpoints.forEach((breakpoint, index) => {
      if (window.scrollY >= breakpoint
      && (!breakpoints[index + 1] || window.scrollY < breakpoints[index + 1])) {
        if (index != currentSection) {
          let scrollOffset = -Math.min(index, sections.length - 2) * foldedHeight;
          wrapper.style.setProperty("--scroll-offset", Math.min(scrollOffset, 0) + "px");

          bullets[currentSection].classList.remove("current");
          bullets[index].classList.add("current");
          currentSection = index;
        }
        return;
      }
    });
  });
  </script>
</body>
</html>
