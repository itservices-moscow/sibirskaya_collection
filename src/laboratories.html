<!DOCTYPE html>
<html lang="ru" class="page">

@include('partials/head.html')

<body class="page__body">
  <div class="site-container" id="site-container">
    @include('partials/header.html')

    <main class="labs">
      <div class="labs__title">
        @include('partials/buffer_top.html')
        @include('partials/arrowback.html')
        <h1 class="heading">собственные лаборатории</h1>
        <p>На производстве с 2013 года функционируют аккредитованные производственные физико&#8209;химическая и микробиологическая лаборатории</p>
      </div>

      <section class="labs">
        <h1 class="bronze">Физико-химическая</h1>
          <div class="accordionL1 accordionL1-1">
            <div class="pagination-track" id="pagination1">
              <div class="pagination">
                <div class="pagination__bullet current"></div>
                <div class="pagination__bullet"></div>
                <div class="pagination__bullet"></div>
              </div>
            </div>
            <div class="accordionL1__control" aria-expanded="false">
              <span class="accordionL1__icon">01</span>
              <span class="accordionL1__title"></span>

            </div>
            <div class="accordionL1__content" aria-hidden="true">
              <div class="container">
                <p>Проводит входной контроль сырья: животного происхождения, масложирового, растительного и муки</p>
                <img src="img/labs-1-01-2x.jpg" width="535" />
              </div>

            </div>
          </div>

          <div class="accordionL1 accordionL1-2">
            <div class="accordionL1__control" aria-expanded="false">
              <span class="accordionL1__icon">02</span>
              <span class="accordionL1__title"></span>

            </div>
            <div class="accordionL1__content" aria-hidden="true">
              <div class="container">
                <p>Исследует более 20 показателей перед допуском сырья для&nbsp;производства</p>
                <img src="img/labs-1-02-2x.jpg" width="535" />
              </div>
            </div>
          </div>

          <div class="accordionL1 accordionL1-3">
            <div class="accordionL1__control" aria-expanded="false">
              <span class="accordionL1__icon">03</span>
              <span class="accordionL1__title"></span>

            </div>
            <div class="accordionL1__content" aria-hidden="true">
              <div class="container">
                <p>Массовые доли белка, жира, сахара, фосфора и других микроэлементов.</p>
                <p>Особое внимание уделяется испытаниям муки: проверяется качество и количество клейковины, число падения, белизна в
                  муке</p>
                <img src="img/labs-1-03-2x.jpg" width="535" />
              </div>
            </div>
          </div>

        <div class="labs__section">
          <div class="labs__heading">
            <h1 class="bronze">Микро-биологическая</h1>
          </div>

          <div class="accordionL2 accordionL2-1">
            <div class="pagination-track" id="pagination2">
              <div class="pagination">
                <div class="pagination__bullet current"></div>
                <div class="pagination__bullet"></div>
              </div>
            </div>
            <div class="accordionL2__control" aria-expanded="false">
              <span class="accordionL2__icon">01</span>
              <span class="accordionL2__title"></span>

            </div>
            <div class="accordionL2__content" aria-hidden="true">
              <div class="container">
                <p>Осуществляет санитарно-микробиологический контроль на всех 8 этапах процесса производства продукции</p>
                <img src="img/labs-2-01-2x.jpg" width="535" />
              </div>

            </div>
          </div>

          <div class="accordionL2 accordionL2-2">
            <div class="accordionL2__control" aria-expanded="false">
              <span class="accordionL2__icon">02</span>
              <span class="accordionL2__title"></span>

            </div>
            <div class="accordionL2__content" aria-hidden="true">
              <div class="container">
                <p>Контроль сырья, готовой продукции, санитарно-гигиенического состояния производственных помещений, технологического
                  оборудования, инвентаря, тары, рук, санитарной одежды работающих</p>
                <img src="img/labs-2-02-2x.jpg" width="535" />
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
    @include('partials/footer.html')
  </div>

  <script type="text/javascript">
    // ================== ACCORDION PLUGINS LABS =================
    class GraphAccordionL1 {
      constructor(selector, options) {
        let defaultOptions = {
          isOpen: () => { },
          isClose: () => { },
          speed: 300
        };
        this.options = Object.assign(defaultOptions, options);
        this.accordion = document.querySelector(selector);
        this.control = this.accordion.querySelector('.accordionL1__control');
        this.content = this.accordion.querySelector('.accordionL1__content');
        this.event();
      }

      event() {
        if (this.accordion) {
          this.accordion.addEventListener('click', (e) => {
            this.accordion.classList.toggle('open');

            if (this.accordion.classList.contains('open')) {
              this.open();
            } else {
              this.close();
            }
          });
        }
      }

      open() {
        this.accordion.style.setProperty('--accordion-time', `${this.options.speed / 1000}s`);
        this.accordion.classList.add('is-open');
        this.control.setAttribute('aria-expanded', true);
        this.content.setAttribute('aria-hidden', false);
        this.content.style.maxHeight = this.content.scrollHeight + 'px';
        this.options.isOpen(this);
      }

      close() {
        this.accordion.classList.remove('is-open');
        this.control.setAttribute('aria-expanded', false);
        this.content.setAttribute('aria-hidden', true);
        this.content.style.maxHeight = null;
        this.options.isClose(this);
      }
    }

    class GraphAccordionL2 {
      constructor(selector, options) {
        let defaultOptions = {
          isOpen: () => { },
          isClose: () => { },
          speed: 300
        };
        this.options = Object.assign(defaultOptions, options);
        this.accordion = document.querySelector(selector);
        this.control = this.accordion.querySelector('.accordionL2__control');
        this.content = this.accordion.querySelector('.accordionL2__content');
        this.event();
      }

      event() {
        if (this.accordion) {
          this.accordion.addEventListener('click', (e) => {
            this.accordion.classList.toggle('open');

            if (this.accordion.classList.contains('open')) {
              this.open();
            } else {
              this.close();
            }
          });
        }
      }

      open() {
        this.accordion.style.setProperty('--accordion-time', `${this.options.speed / 1000}s`);
        this.accordion.classList.add('is-open');
        this.control.setAttribute('aria-expanded', true);
        this.content.setAttribute('aria-hidden', false);
        this.content.style.maxHeight = this.content.scrollHeight + 'px';
        this.options.isOpen(this);
      }

      close() {
        this.accordion.classList.remove('is-open');
        this.control.setAttribute('aria-expanded', false);
        this.content.setAttribute('aria-hidden', true);
        this.content.style.maxHeight = null;
        this.options.isClose(this);
      }
    }

    // const accordion1 = new GraphAccordionL1('.accordionL1-1', {
    //   speed: 500
    // });
    // accordion1.open();
    //
    // const accordion2 = new GraphAccordionL1('.accordionL1-2', {
    //   speed: 500
    // });
    // accordion2.open();
    //
    // const accordion3 = new GraphAccordionL1('.accordionL1-3', {
    //   speed: 500
    // });
    // accordion3.open();
    //
    //
    //
    // const accordion4 = new GraphAccordionL2('.accordionL2-1', {
    //   speed: 500
    // });
    // accordion4.open();
    //
    // const accordion5 = new GraphAccordionL2('.accordionL2-2', {
    //   speed: 500
    // });
    // accordion5.open();

    const wrapper = document.querySelector("main.labs");
    const stickyOffset = parseInt(getComputedStyle(wrapper).getPropertyValue("--sticky-offset"));
    const labsP = document.querySelector(".labs__title p");

    document.documentElement.scrollTop = 0;

    wrapper.style.setProperty("--heading-offset", labsP.offsetTop + labsP.offsetHeight + "px");

    document.querySelectorAll(".pagination").forEach((el, i) => {
      const sectionName = `.accordionL${i + 1}`;
      const sections = document.querySelectorAll(sectionName);
      const bullets = el.querySelectorAll(".pagination__bullet");
      const parentOffset = sections[0].offsetParent.offsetTop;
      const breakpoints = Array.prototype.map.call(
        sections,
        (el) => parentOffset + el.offsetTop - stickyOffset
      );
      let currentSection = 0;

      sections.forEach((el, index) => {
        const scrollToSection = () => window.scrollTo({ top: breakpoints[index] });
        el.querySelector(`${sectionName}__control`).addEventListener("click", scrollToSection);
        bullets[index].addEventListener("click", scrollToSection);
      });

      window.addEventListener("scroll", function () {
        breakpoints.forEach((breakpoint, index) => {
          if (window.scrollY >= breakpoint
          && (!breakpoints[index + 1] || window.scrollY < breakpoints[index + 1])) {
            if (index != currentSection) {
              bullets[currentSection].classList.remove("current");
              bullets[index].classList.add("current");
              currentSection = index;
            }
            return;
          }
        });
      });
    });
  </script>
</body>
</html>
